# dsp-adau1452

It uses adau1452 as DSP. Examples of working projects.


1. Make


# Russian

*Примеры проектов на adau1452.*

**Использовались:**
* [RDC3-0027v1, SigmaDSP ADAU1452. Модуль цифровой обработки звука. V1](https://www.chipdip.ru/product/rdc3-0027v1)
* [USB I2S преобразователь 32bit/96kHz, SUPER PRIME chipdip, USB Hi-Res Audio, квадро, STM32F446RC](https://www.chipdip.ru/product0/9000569733)
* [PCM5102A audio DAC, Преобразователь: I2S - Аудио. Разрешение 32 бит, частота дискретизации 384kHz](https://www.chipdip.ru/product/pcm5102a-audio-dac)
* [PCM1808 audio ADC, Преобразователь: Аудио - I2S. Разрешение 24 бит, частота дискретизации 96kHz](https://www.chipdip.ru/product/pcm1808-audio-adc)
* [SigmaLink-USBi, USBi программатор для SigmaStudio](https://www.chipdip.ru/product/sigmalink-usbi)
* Переменные резисторы 10кОм...100кОм

Всё по цене дешевле чем у китайцев брать что-то похожее и без гаранции, что заработает.

## 0. В начале проверяем работоспособность платы.

## 1. Версия без микроконтроллера с переменными резисторами. Лежит в папке first.
Входы: USB через SUPER PRIME, китайский bluetooth 5.0 модуль подключенный через PCM1808 к ADAU1452, возможно использовать оставшиеся два входа и SPDIF. Селектор на пять каналов это подразумевает.
Выходы: один PCM5102A серео.
Задействовано 5 переменных резисторов подключенных на AUXDAC0-4:
 - селектор 5 входов, 5ый вход тестовый, генерит шум и синусоиду;
 - Регулятор громкости;
 - регулятор баланса;
 - фильтр низких частот (до 100Гц);
 - фильтр высоких частот (от 5кГц).

У первого входа стоят фильтры от постоянки на входе и фильтры высоких частот от 20Гц, чтобы обрезать всё что ниже.
Никакой особой обработки звука, кроссоверов, параметрических эквалезеров и пр.

Были проблемы с землёй и питанием, у ЦАПа и АЦП не подключал 3.3в ножку, питание через +5в.
USBi так же убрал +3.3в подключение к adau.
Питание от SUPER PRIME, подключил +5в туда внешние. От компа через SUPER PRIME так же ок.
Так же при подключении в параллель USBi и SUPER PRIME - земляная петля часто - треск и помехи.

С SUPER PRIME - были танцы с бубном, прошил с v1.4 до v1.5.1 - заработало всё что с 48кГц и ниже.
Что бы запустить на 32 бита и 96кГц надо в проекте во вкладке CLOCK CONTROL опцию "PLL input clock divider" установить в "Вумшву ин 8".

*На слух какая-то особенность с регулировкой баланса, не совсем разобрался.*


**Макетная плата**
![Макетная плата](/first/maket.jpg)


**Основная схема**
![Основная схема](/first/main_scheme.png)


**Табица сравнения селектора входов**
![Табица сравнения селектора входов](/first/channel_select_table.png)


**Настройка ФНЧ**
![Настройка ФНЧ](/first/bass_settings.png)


**Настройка ФВЧ**
![Настройка ФВЧ](/first/treble_settings.png)


**Вкладка настройки CLOCK CONTROL**
![Вкладка настройки CLOCK CONTROL](/first/clock_control_settings.png)


**Вкладка настройки CORE CONTROL**
![Вкладка настройки CORE CONTROL](/first/core_control_settings.png)


**Вкладка настройки SERIAL PORT**
![Вкладка настройки SERIAL PORT](/first/serial_port_settings.png)


## 2. Версия без микроконтроллера с переменными резисторами. Перебор каналов - кнопкой. Лежит в папке button_source_selection.

Проект трансформирован из первого, убраны регуляторы ФНЧ/ФВЧ и селектор каналов, добавлена кнопка для перебора каналов.
Входы: USB через SUPER PRIME, китайский bluetooth 5.0 модуль подключенный через PCM1808 к ADAU1452, возможно использовать оставшиеся ОДИН вход и SPDIF. Селектор на пять каналов.
Два последних канала - тестовых.
Один вход занят кнопкой в режиме GPIO. Контакт LRCLK_IN3 / MP13.
Выходы: один PCM5102A серео.
Задействовано 2 переменных резистора подключенных на AUXDAC0-4:
 - Регулятор громкости;
 - регулятор баланса;

Кнопку подключаем - один вывод к pin MP13, другой контакт к +3.3В.


**Макетная плата**
![Макетная плата](/button_source_selection/maket.jpg)


**Основная схема**
![Основная схема](/button_source_selection/button_selection_schema.png)


**Вкладка настройки MULTIPURPOSE / AUXADC**
![Вкладка настройки MULTIPURPOSE / AUXADC](/button_source_selection/mp13_settings.png)

## 3. Версия с микроконтроллером Arduino. Демонстация отправки команды mute в DPS ADAU1452 при помощи Arduino

**Дополнительно использовались:**
* [Ванилин, Программируемый контроллер на базе ATmega328P-AU, CP2102 (Arduino Uno)](https://www.chipdip.ru/product/vanilin-2)
* [RDC2-0015A, Преобразователь уровней напряжения. 4 в 1.](https://www.chipdip.ru/product/rdc2-0015a)

Проект SigmaDSP такй де как N2
Входы: USB через SUPER PRIME, китайский bluetooth 5.0 модуль подключенный через PCM1808 к ADAU1452, возможно использовать оставшиеся ОДИН вход и SPDIF. Селектор на пять каналов.
Два последних канала - тестовых.
Один вход занят кнопкой в режиме GPIO. Контакт LRCLK_IN3 / MP13.
Выходы: один PCM5102A серео.

**Схема:**
DSP подключен по I2C к Arduino к SDA (A4) и SLC (A5) по адресу 0x38, подключение через двунаправленный перобразователь уровня для 5в - 3.3в
К D2 подключена кнопка, которая включает/отключает Mute
К Arduino так же по I2C подключен двухстрочный дисплей по адресу 0x270x27

Команду для вкл/выкл mute - забираем из SigmaStudio в логах.

**arduino проект**
![Демонстация отправки команды mute в DPS ADAU1452 при помощи Arduino](/adau1452_arduino_mute_control/)

## 4. Версия с микроконтроллером Arduino.

**Использовались:**
* [RDC3-0027v1, SigmaDSP ADAU1452. Модуль цифровой обработки звука. V1](https://www.chipdip.ru/product/rdc3-0027v1)
* [USB I2S преобразователь 32bit/96kHz, SUPER PRIME chipdip, USB Hi-Res Audio, квадро, STM32F446RC](https://www.chipdip.ru/product0/9000569733)
* [PCM5102A audio DAC, Преобразователь: I2S - Аудио. Разрешение 32 бит, частота дискретизации 384kHz](https://www.chipdip.ru/product/pcm5102a-audio-dac)
* [PCM1808 audio ADC, Преобразователь: Аудио - I2S. Разрешение 24 бит, частота дискретизации 96kHz](https://www.chipdip.ru/product/pcm1808-audio-adc)
* [SigmaLink-USBi, USBi программатор для SigmaStudio](https://www.chipdip.ru/product/sigmalink-usbi)
* [Ванилин, Программируемый контроллер на базе ATmega328P-AU, CP2102 (Arduino Uno)](https://www.chipdip.ru/product/vanilin-2)
* [RDC2-0015A, Преобразователь уровней напряжения. 4 в 1.](https://www.chipdip.ru/product/rdc2-0015a)
* Энкодер
* Два ёмкосных датчика-кнопки
* Синий светодиод + резитор 220 Ом
* Красный светодиод + резистор 220 Ом
* Фоторезистор + 10кОм резистор, включено: одна нога фоторезистора на +5в, вторая нога фоторезистора соединяется с резистором и подключается к A0 Arduino, вторая нога рещистора подключается к GND.
* LCD экран 16х2 подклюаемый по I2C

Входы: USB через SUPER PRIME, китайский bluetooth 5.0 модуль подключенный через I2S к ADAU1452, линейный вход, подключенный через PCM1808 к ADAU1452, SPDIF оптика через RX147, FM в проекте.
Выходы: один PCM5102A серео, два PCM5102A для XLR стерео выхода, дополнительно к каждому PCM5102A в месте подключения +5в и GND подключены конденсаторы 100мкФ и 0.1мкФ, иначе слышимые помехи, при включении лишь одного DAC ничего не нужно.

У входа стоят фильтры от постоянки на входе и фильтры высоких частот от 20Гц, чтобы обрезать всё что ниже.
Управления:
1 кнопка выклю/выкл - система засыпает
2 кнопка выбора каналов: последовательно BT -> USB -> LineIn -> FM -> SPDIF
3 Энкодер: клик - выбор параметра для регулировки, вращение - смена регулировки.
  Параметры:
  * громкость
  * баланс
  * включение супер басс
  * включение динамический басс
  * включение расширения стереобазы
После простоя работы с меню - преключение на громкость.

**Основная схема**
![Основная схема](/arduino_controlled/dsp_scheme.png)

**Подключение блоков**
![Подключение блоков](/arduino_controlled/dsp_connect.png)

**Настройка DSP EEPROM**
![Настройка DSP EEPROM](/arduino_controlled/dsp_eeprom_settings.png)

**Вкладка настройки CLOCK CONTROL**
![Вкладка настройки CLOCK CONTROL](/arduino_controlled/clock_control_settings.png)

**Вкладка настройки asrc0**
![Вкладка настройки asrc0](/arduino_controlled/asrc0_settings.png)

**Вкладка настройки asrc1**
![Вкладка настройки asrc1](/arduino_controlled/asrc1_settings.png)

**Вкладка настройки SERIAL PORT**
![Вкладка настройки SERIAL PORT](/arduino_controlled/serial_ports_settings.png)

**Вкладка настройки для настройка портов**
![Вкладка настройки для настройка портов](/arduino_controlled/ports_settings.png)
